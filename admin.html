<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Russo Gourmet</title>
    <style>
        :root { --primary: #5c4033; --bg: #fdfaf5; }
        body { display: flex; background: var(--bg); font-family: sans-serif; margin: 0; }
        .sidebar { width: 220px; background: #3d2b1f; color: white; height: 100vh; position: fixed; padding: 20px; }
        .sidebar button { width: 100%; padding: 12px; margin-bottom: 10px; background: none; border: none; color: white; text-align: left; cursor: pointer; font-weight: bold; border-radius: 8px; }
        .sidebar button.active { background: var(--primary); }
        .main { margin-left: 260px; flex: 1; padding: 30px; }
        .card-adm { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #eaddcf; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .item-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f2ece4; align-items: center; }
        input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-save { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Russo Admin</h3><br>
        <button onclick="aba('c')" id="btn-c" class="active">üç∞ Gerenciar Doces</button>
        <button onclick="aba('h')" id="btn-h">üïí Hor√°rios</button>
    </div>

    <main class="main">
        <section id="sec-c">
            <h2>Card√°pio em Tempo Real</h2>
            <div id="grid-c" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;"></div>
        </section>

        <section id="sec-h" style="display:none">
            <h2>Hor√°rios de Funcionamento</h2>
            <div class="card-adm" id="grid-h"></div>
            <button class="btn-save" onclick="salvarH()">Salvar Hor√°rios</button>
        </section>
    </main>

    <div id="modal-edicao" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:3000; align-items:center; justify-content:center;">
        <div class="card-adm" style="width: 400px;">
            <h3 id="m-titulo">Editar Item</h3>
            <input type="hidden" id="edit-id">
            <input type="text" id="m-nome" placeholder="Nome do Doce">
            <textarea id="m-desc" placeholder="Descri√ß√£o"></textarea>
            <input type="text" id="m-preco" placeholder="Pre√ßo (ex: 15,00)">
            <input type="text" id="m-promo" placeholder="Pre√ßo Promo (Opcional)">
            <input type="text" id="m-foto" placeholder="Link da Foto">
            <button class="btn-save" style="width:100%" onclick="salvarItem()">SALVAR NA NUVEM</button>
            <button onclick="document.getElementById('modal-edicao').style.display='none'" style="width:100%; border:none; background:none; margin-top:10px; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDiS_Mg9aN6zeU_V7ZReBUv_sTeHXcvz4",
            authDomain: "russo-gourmet.firebaseapp.com",
            databaseURL: "https://russo-gourmet-default-rtdb.firebaseio.com",
            projectId: "russo-gourmet",
            storageBucket: "russo-gourmet.firebasestorage.app",
            messagingSenderId: "1072063151238",
            appId: "1:1072063151238:web:c2ad5f6495669559fee507"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const categorias = ["Morango do amor", "Coxinha unitaria", "Copo da felicidade-200ml", "Combinho russo(1 pessoa)", "Combinho casal(2 pessoas)", "Piscininha recheada", "Barras recheadas", "Copos da felicidade", "Mega cone trufado", "Bebidas", "Combo russo 2.0", "Combo russo 3.0", "Combinho russo", "Fatias", "Marmitinha"];
        const diasSemana = ["Domingo", "Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado"];
        let catAtual = "";

        // Carregar Card√°pio
        db.ref('cardapio').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            renderC(data);
        });

        function renderC(data) {
            const grid = document.getElementById('grid-c');
            grid.innerHTML = categorias.map(cat => `
                <div class="card-adm">
                    <div style="display:flex; justify-content:space-between"><b>${cat}</b> <button onclick="abrirM('${cat}')" style="background:#5c4033; color:white; border:none; border-radius:4px; padding:2px 8px; cursor:pointer;">+</button></div>
                    ${Object.entries(data[cat] || {}).map(([id, p]) => `
                        <div class="item-row" style="${p.esgotado ? 'opacity:0.4' : ''}">
                            <small>${p.nome}</small>
                            <div>
                                <button onclick="toggleEsgotado('${cat}', '${id}', ${p.esgotado})">${p.esgotado ? '‚ùå' : '‚úÖ'}</button>
                                <button onclick="editar('${cat}', '${id}')">‚úèÔ∏è</button>
                                <button onclick="excluir('${cat}', '${id}')">üóëÔ∏è</button>
                            </div>
                        </div>`).join('')}
                </div>`).join('');
        }

        // Fun√ß√µes de Itens
        function abrirM(cat) {
            catAtual = cat; document.getElementById('edit-id').value = "";
            document.getElementById('m-nome').value = ""; document.getElementById('m-preco').value = "";
            document.getElementById('m-desc').value = ""; document.getElementById('m-promo').value = "";
            document.getElementById('m-foto').value = "";
            document.getElementById('modal-edicao').style.display = 'flex';
        }

        function salvarItem() {
            const id = document.getElementById('edit-id').value;
            const obj = {
                nome: document.getElementById('m-nome').value,
                desc: document.getElementById('m-desc').value,
                preco: document.getElementById('m-preco').value,
                promo: document.getElementById('m-promo').value,
                foto: document.getElementById('m-foto').value,
                esgotado: false
            };
            if(id === "") db.ref('cardapio/' + catAtual).push(obj);
            else db.ref('cardapio/' + catAtual + '/' + id).update(obj);
            document.getElementById('modal-edicao').style.display = 'none';
        }

        function toggleEsgotado(cat, id, status) { db.ref('cardapio/' + cat + '/' + id).update({ esgotado: !status }); }
        function excluir(cat, id) { if(confirm("Excluir?")) db.ref('cardapio/' + cat + '/' + id).remove(); }
        function editar(cat, id) {
            catAtual = cat;
            db.ref('cardapio/' + cat + '/' + id).once('value', (s) => {
                const p = s.val();
                document.getElementById('edit-id').value = id;
                document.getElementById('m-nome').value = p.nome;
                document.getElementById('m-desc').value = p.desc || "";
                document.getElementById('m-preco').value = p.preco;
                document.getElementById('m-promo').value = p.promo || "";
                document.getElementById('m-foto').value = p.foto || "";
                document.getElementById('modal-edicao').style.display = 'flex';
            });
        }

        // L√≥gica de Hor√°rios
        function renderH() {
            db.ref('horarios').once('value', (s) => {
                const h = s.val() || {};
                const grid = document.getElementById('grid-h');
                grid.innerHTML = diasSemana.map(dia => `
                    <div class="item-row">
                        <span style="width:100px"><strong>${dia}</strong></span>
                        <input type="text" id="h-${dia}" value="${h[dia] || '18:00 - 23:00'}" style="margin:0">
                    </div>`).join('');
            });
        }

        function salvarH() {
            const novosH = {};
            diasSemana.forEach(dia => novosH[dia] = document.getElementById('h-'+dia).value);
            db.ref('horarios').set(novosH).then(() => alert("Hor√°rios Salvos!"));
        }

        function aba(id) {
            document.getElementById('sec-c').style.display = id === 'c' ? 'block' : 'none';
            document.getElementById('sec-h').style.display = id === 'h' ? 'block' : 'none';
            document.getElementById('btn-c').className = id === 'c' ? 'active' : '';
            document.getElementById('btn-h').className = id === 'h' ? 'active' : '';
            if(id === 'h') renderH();
        }
    </script>
</body>
</html>

