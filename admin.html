<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Russo Gourmet</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --marrom: #3d2b1f; --offwhite: #fdfaf5; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--offwhite); }
        .nav { background: var(--marrom); padding: 15px; display: flex; gap: 10px; position: sticky; top: 0; z-index: 100; }
        .nav button { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; background: #554133; color: #ccc; }
        .nav button.active { background: white; color: var(--marrom); }
        .container { padding: 15px; max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 450px; padding: 25px; border-radius: 20px; max-height: 90vh; overflow-y: auto; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn-main { background: var(--marrom); color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        #preview-img { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

    <div class="nav">
        <button onclick="aba('c')" id="btn-c" class="active">PRODUTOS</button>
        <button onclick="aba('h')" id="btn-h">HOR√ÅRIOS</button>
    </div>

    <div class="container">
        <section id="sec-c">
            <div id="grid-c"></div>
        </section>

        <section id="sec-h" style="display:none">
            <div class="card" id="lista-horarios"></div>
            <button class="btn-main" onclick="salvarH()">SALVAR HOR√ÅRIOS</button>
        </section>
    </div>

    <div id="modal-edicao" class="modal">
        <div class="modal-content">
            <h3 id="m-titulo">Editar Item</h3><br>
            <input type="hidden" id="edit-id">
            <input type="text" id="m-nome" placeholder="Nome do Doce">
            <textarea id="m-desc" placeholder="Descri√ß√£o"></textarea>
            <input type="text" id="m-preco" placeholder="Pre√ßo (Ex: 15,00)">
            <input type="text" id="m-promo" placeholder="Pre√ßo Promo (Opcional)">
            
            <p style="font-size: 0.8rem; margin-bottom: 5px;">Foto do Produto:</p>
            <img id="preview-img">
            <input type="file" id="m-foto-file" accept="image/*">
            <input type="hidden" id="m-foto-base64">

            <button class="btn-main" onclick="salvarItem()">SALVAR NO BANCO</button>
            <button onclick="fecharM()" style="width:100%; border:none; background:none; margin-top:15px; color:#999; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDiS_Mg9aN6zeU_V7ZReBUv_sTeHXcvz4",
            authDomain: "russo-gourmet.firebaseapp.com",
            databaseURL: "https://russo-gourmet-default-rtdb.firebaseio.com",
            projectId: "russo-gourmet",
            storageBucket: "russo-gourmet.firebasestorage.app",
            messagingSenderId: "1072063151238",
            appId: "1:1072063151238:web:c2ad5f6495669559fee507"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const categorias = ["Coxinha unitaria", "Copo da felicidade-200ml", "Combinho russo(1 pessoa)", "Combinho casal(2 pessoas)", "Piscininha recheada", "Barras recheadas", "Copos da felicidade", "Mega cone trufado", "Bebidas", "Combo russo 2.0", "Combo russo 3.0", "Combinho russo", "Fatias", "Marmitinha"];

        // Conversor de Imagem para Base64
        document.getElementById('m-foto-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = function() {
                    document.getElementById('m-foto-base64').value = reader.result;
                    const prev = document.getElementById('preview-img');
                    prev.src = reader.result;
                    prev.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        db.ref('cardapio').on('value', snap => {
            const data = snap.val() || {};
            const grid = document.getElementById('grid-c');
            grid.innerHTML = categorias.map(cat => `
                <div class="card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <b style="color:#8b5e3c">${cat}</b>
                        <button onclick="abrirM('${cat}')" style="background:none; border:none; font-size:1.2rem; cursor:pointer;">‚ûï</button>
                    </div>
                    ${Object.entries(data[cat] || {}).map(([id, p]) => `
                        <div class="item-row" style="${p.esgotado ? 'opacity:0.5' : ''}">
                            <span style="font-size:0.85rem">${p.nome}</span>
                            <div>
                                <button onclick="toggleEsgotado('${cat}','${id}',${p.esgotado})" style="border:none; background:none; cursor:pointer;">${p.esgotado ? '‚ùå' : '‚úÖ'}</button>
                                <button onclick="editar('${cat}','${id}')" style="border:none; background:none; cursor:pointer; margin-left:10px;">‚úèÔ∏è</button>
                                <button onclick="excluir('${cat}','${id}')" style="border:none; background:none; cursor:pointer; margin-left:10px;">üóëÔ∏è</button>
                            </div>
                        </div>`).join('')}
                </div>`).join('');
        });

        db.ref('config/horarios').on('value', s => {
            const h = s.val() || {};
            const dias = ["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"];
            document.getElementById('lista-horarios').innerHTML = dias.map(d => `
                <div style="display:flex; justify-content:space-between; margin-bottom:12px; align-items:center;">
                    <b style="font-size:0.9rem">${d}</b>
                    <span><input type="time" id="a-${d}" value="${h[d]?.abre || '09:00'}" style="width:85px; margin:0"> - <input type="time" id="f-${d}" value="${h[d]?.fecha || '22:00'}" style="width:85px; margin:0"></span>
                </div>`).join('');
        });

        function salvarH() {
            const h = {};
            ["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"].forEach(d => {
                h[d] = { abre: document.getElementById('a-'+d).value, fecha: document.getElementById('f-'+d).value };
            });
            db.ref('config/horarios').set(h).then(() => alert("Hor√°rios salvos!"));
        }

        function abrirM(cat) {
            catAtual = cat; 
            document.getElementById('edit-id').value = "";
            document.getElementById('m-nome').value = ""; 
            document.getElementById('m-preco').value = "";
            document.getElementById('m-desc').value = ""; 
            document.getElementById('m-promo').value = "";
            document.getElementById('m-foto-base64').value = "";
            document.getElementById('preview-img').style.display = 'none';
            document.getElementById('modal-edicao').style.display = 'flex';
        }

        function editar(cat, id) {
            catAtual = cat;
            db.ref('cardapio/'+cat+'/'+id).once('value', s => {
                const p = s.val();
                document.getElementById('edit-id').value = id;
                document.getElementById('m-nome').value = p.nome;
                document.getElementById('m-desc').value = p.desc || "";
                document.getElementById('m-preco').value = p.preco;
                document.getElementById('m-promo').value = p.promo || "";
                document.getElementById('m-foto-base64').value = p.foto || "";
                if(p.foto) {
                    const prev = document.getElementById('preview-img');
                    prev.src = p.foto;
                    prev.style.display = 'block';
                }
                document.getElementById('modal-edicao').style.display = 'flex';
            });
        }

        function salvarItem() {
            const id = document.getElementById('edit-id').value;
            const item = { 
                nome: document.getElementById('m-nome').value, 
                desc: document.getElementById('m-desc').value, 
                preco: document.getElementById('m-preco').value, 
                promo: document.getElementById('m-promo').value, 
                foto: document.getElementById('m-foto-base64').value, 
                esgotado: false 
            };
            if(!item.nome || !item.preco) return alert("Preencha o nome e pre√ßo!");
            
            if(id === "") db.ref('cardapio/'+catAtual).push(item);
            else db.ref('cardapio/'+catAtual+'/'+id).update(item);
            fecharM();
        }

        function toggleEsgotado(cat, id, s) { db.ref('cardapio/'+cat+'/'+id).update({esgotado: !s}); }
        function excluir(cat, id) { if(confirm("Apagar doce?")) db.ref('cardapio/'+cat+'/'+id).remove(); }
        function fecharM() { document.getElementById('modal-edicao').style.display = 'none'; }
        function aba(id) {
            document.getElementById('sec-c').style.display = id==='c'?'block':'none';
            document.getElementById('sec-h').style.display = id==='h'?'block':'none';
            document.getElementById('btn-c').className = id==='c'?'active':'';
            document.getElementById('btn-h').className = id==='h'?'active':'';
        }
    </script>
</body>
</html>



