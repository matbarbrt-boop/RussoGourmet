<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Russo Gourmet | CardÃ¡pio</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>
    <section class="brand-section">
        <div class="logo-wrapper"><img src="russogourmet.png" class="logo-circle"></div>
        <h1 class="brand-name">Russo Gourmet</h1>
        <div id="status-loja" style="font-size: 0.85rem; margin-top: 5px;"></div>
    </section>

    <main class="container" id="menu-render">
        <p style="text-align:center; padding:50px;">Carregando delÃ­cias...</p>
    </main>

    <div id="cart-bar" class="cart-bar" onclick="abrirCheckout()" style="display: none;">
        <span>ðŸ›’ Ver Pedido</span>
        <span id="cart-total-bar">R$ 0,00</span>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDiS_Mg9aN6zeU_V7ZReBUv_sTeHXcvz4",
            authDomain: "russo-gourmet.firebaseapp.com",
            databaseURL: "https://russo-gourmet-default-rtdb.firebaseio.com",
            projectId: "russo-gourmet",
            storageBucket: "russo-gourmet.firebasestorage.app",
            messagingSenderId: "1072063151238",
            appId: "1:1072063151238:web:c2ad5f6495669559fee507"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let carrinho = [];
        const diasSemana = ["Domingo", "Segunda", "TerÃ§a", "Quarta", "Quinta", "Sexta", "SÃ¡bado"];

        // Carregar CardÃ¡pio e Status
        db.ref('cardapio').on('value', (snapshot) => {
            renderizar(snapshot.val() || {});
        });

        db.ref('horarios').on('value', (s) => {
            const h = s.val() || {};
            const hoje = diasSemana[new Date().getDay()];
            document.getElementById('status-loja').innerHTML = `ðŸ•’ Aberto hoje: ${h[hoje] || 'Consulte-nos'}`;
        });

        function renderizar(data) {
            const menu = document.getElementById('menu-render');
            menu.innerHTML = "";
            Object.keys(data).forEach(cat => {
                menu.innerHTML += `<h3 style="margin: 25px 15px 10px; color: #5c4033;">${cat}</h3>`;
                Object.entries(data[cat]).forEach(([id, p]) => {
                    menu.innerHTML += `
                    <div class="product-card" style="${p.esgotado ? 'opacity:0.6; filter:grayscale(1);' : ''}">
                        <img src="${p.foto || 'https://via.placeholder.com/150'}" class="product-img">
                        <div style="flex:1">
                            <h4>${p.nome}</h4>
                            <p style="font-size:0.75rem; color:#666">${p.desc || ''}</p>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                                <span class="price-tag">R$ ${p.promo || p.preco}</span>
                                ${p.esgotado ? '<b style="color:red">Esgotado</b>' : 
                                `<button class="btn-order" onclick="addCarrinho('${p.nome}', '${p.promo || p.preco}')">+ Add</button>`}
                            </div>
                        </div>
                    </div>`;
                });
            });
        }

        function addCarrinho(nome, preco) {
            const valor = parseFloat(preco.replace(',', '.'));
            const item = carrinho.find(i => i.nome === nome);
            if(item) item.qtd++; else carrinho.push({ nome, preco: valor, qtd: 1 });
            atualizarBarra();
        }

        function atualizarBarra() {
            const bar = document.getElementById('cart-bar');
            const total = carrinho.reduce((acc, i) => acc + (i.preco * i.qtd), 0);
            bar.style.display = carrinho.length > 0 ? 'flex' : 'none';
            document.getElementById('cart-total-bar').innerText = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        function abrirCheckout() {
            const nome = prompt("Seu nome?");
            if(!nome) return;
            
            let msg = `*NOVO PEDIDO - RUSSO GOURMET*\nðŸ‘¤ Cliente: ${nome}\n\n`;
            let total = 0;
            carrinho.forEach(i => {
                msg += `âœ… ${i.qtd}x ${i.nome} - R$ ${(i.preco * i.qtd).toFixed(2)}\n`;
                total += i.preco * i.qtd;
            });
            msg += `\n*TOTAL: R$ ${total.toFixed(2)}*`;
            msg += `\n\nðŸ”‘ *PIX:* 13982155569\n_Envie o endereÃ§o de entrega abaixo:_`;
            
            window.open(`https://wa.me/5513982155569?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
