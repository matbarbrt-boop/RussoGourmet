<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Russo Gourmet | Card√°pio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --marrom: #3d2b1f; --marrom-claro: #8b5e3c; --offwhite: #fdfaf5; --branco: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--offwhite); color: var(--marrom); padding-bottom: 100px; }
        .header { background: var(--marrom); color: var(--branco); text-align: center; padding: 30px 20px; border-radius: 0 0 30px 30px; }
        .container { width: 100%; max-width: 600px; margin: 0 auto; padding: 15px; }
        .product-card { background: var(--branco); display: flex; padding: 12px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); border: 1px solid #eee; }
        .product-img { width: 75px; height: 75px; border-radius: 10px; object-fit: cover; margin-right: 12px; }
        .btn-add { background: var(--marrom); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
        .cart-bar { position: fixed; bottom: 15px; left: 5%; width: 90%; background: var(--marrom); color: white; padding: 16px; border-radius: 15px; display: flex; justify-content: space-between; font-weight: bold; z-index: 1000; box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .modal-full { position: fixed; inset: 0; background: var(--offwhite); z-index: 2000; padding: 15px; overflow-y: auto; display: none; }
        input, select, textarea { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; background: white; }
        .taxa-info { background: #f0ede9; padding: 10px 15px; border-radius: 10px; margin-bottom: 8px; font-size: 0.85rem; display: flex; justify-content: space-between; }
        .btn-final { background: #2b9348; color: white; width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: 800; font-size: 1rem; margin-top: 10px; cursor: pointer; }
        h3.cat-title { margin: 25px 0 10px 5px; font-size: 1.1rem; border-left: 4px solid var(--marrom-claro); padding-left: 10px; }
        
        /* Novos estilos para os bot√µes de ajuste no checkout */
        .item-checkout { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
        .qtd-controls { display: flex; align-items: center; gap: 10px; }
        .btn-qty { background: #eee; border: none; width: 28px; height: 28px; border-radius: 50%; font-weight: bold; cursor: pointer; color: var(--marrom); }
    </style>
</head>
<body>

    <header class="header">
        <h1 style="font-size: 1.5rem; letter-spacing: 1px;">RUSSO GOURMET</h1>
        <div id="status-loja" style="font-size: 0.75rem; margin-top:8px; font-weight: 600;"></div>
    </header>

    <main class="container" id="menu-render">
        <p style="text-align: center; padding: 40px; color: #999;">Carregando card√°pio...</p>
    </main>

    <div id="cart-bar" class="cart-bar" onclick="abrirCheckout()" style="display:none">
        <span>üõí VER SACOLA</span>
        <span id="cart-total-bar">R$ 0,00</span>
    </div>

    <div id="modal-checkout" class="modal-full">
        <div class="container" style="padding: 0;">
            <h2 style="margin-bottom:15px;">Sua Sacola</h2>
            <div id="resumo-itens" style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px;"></div>
            
            <div class="taxa-info"><span>Produtos:</span> <b id="subtotal-val">R$ 0,00</b></div>
            <div class="taxa-info"><span>Entrega:</span> <b id="taxa-val">R$ 0,00</b></div>
            <div id="box-taxa-troco" class="taxa-info" style="display:none; color: #d9534f; border: 1px solid #d9534f;"><span>Taxa p/ Troco:</span> <b>R$ 2,00</b></div>
            <h3 id="total-final" style="text-align: right; color: var(--marrom-claro); margin: 15px 5px; font-size: 1.4rem;"></h3>
            
            <input type="text" id="c-nome" placeholder="Seu Nome">
            
            <select id="c-bairro" onchange="atualizarTotal()">
                <option value="0">Escolha o Bairro...</option>
                <option value="7">Pae Car√° (R$ 7,00)</option>
                <option value="7">Vila Alice (R$ 7,00)</option>
                <option value="7">Cunhambebe (R$ 7,00)</option>
                <option value="7">Parque Estu√°rio (R$ 7,00)</option>
                <option value="8">Jardim Progresso (R$ 8,00)</option>
                <option value="8">Vila √Åurea (R$ 8,00)</option>
                <option value="8">Monteiro da Cruz (R$ 8,00)</option>
                <option value="8">Prainha (R$ 8,00)</option>
                <option value="10">Aldeia (R$ 10,00)</option>
                <option value="9">Boa Esperan√ßa (R$ 9,00)</option>
                <option value="10">Jardim Concei√ß√£ozinha (R$ 10,00)</option>
                <option value="13">S√≠tio Concei√ß√£ozinha (R$ 13,00)</option>
                <option value="13">Pra√ßa Yara Santini (R$ 13,00)</option>
            </select>

            <input type="text" id="c-rua" placeholder="Rua, N√∫mero e Apto">
            <input type="text" id="c-ref" placeholder="Ponto de Refer√™ncia">
            
            <p style="font-size: 0.85rem; margin: 10px 5px 5px;"><b>Pagamento:</b></p>
            <select id="c-pag" onchange="checkPagamento()">
                <option value="Pix">Pix (Chave: 13982155569)</option>
                <option value="Link de Pagamento (Enviar ap√≥s o pedido)">Link de Pagamento</option>
                <option value="Dinheiro">Dinheiro</option>
            </select>

            <div id="box-troco" style="display:none; background: #fff5f5; padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                <p style="font-size: 0.75rem; color: #d9534f; margin-bottom: 8px;">* Troco tem acr√©scimo de R$ 2,00</p>
                <select id="c-precisa-troco" onchange="atualizarTotal()">
                    <option value="N√£o">N√£o preciso de troco</option>
                    <option value="Sim">Sim, preciso (+ R$ 2,00)</option>
                </select>
                <input type="text" id="c-quanto-troco" placeholder="Troco para quanto?">
            </div>

            <div id="pix-box" style="background:#e8f5e9; padding:12px; border-radius:10px; margin-bottom:15px; border:1px dashed #2b9348; font-size: 0.85rem;">
                <b>Chave Pix: 13982155569</b>
            </div>

            <button class="btn-final" onclick="enviarWhatsApp()">FINALIZAR NO WHATSAPP</button>
            <button onclick="fecharCheckout()" style="width:100%; margin-top:15px; border:none; background:none; color:#999; padding: 10px;">Continuar Comprando</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDiS_Mg9aN6zeU_V7ZReBUv_sTeHXcvz4",
            authDomain: "russo-gourmet.firebaseapp.com",
            databaseURL: "https://russo-gourmet-default-rtdb.firebaseio.com",
            projectId: "russo-gourmet",
            storageBucket: "russo-gourmet.firebasestorage.app",
            messagingSenderId: "1072063151238",
            appId: "1:1072063151238:web:c2ad5f6495669559fee507"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let carrinho = [];
        let lojaAberta = false;

        db.ref('config/horarios').on('value', s => {
            const h = s.val() || {};
            const hoje = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"][new Date().getDay()];
            const config = h[hoje] || { abre: "09:00", fecha: "22:00" };
            const agora = new Date().getHours()*60 + new Date().getMinutes();
            const [ha, ma] = config.abre.split(':').map(Number);
            const [hf, mf] = config.fecha.split(':').map(Number);
            lojaAberta = agora >= (ha*60+ma) && agora <= (hf*60+mf);
            document.getElementById('status-loja').innerText = lojaAberta ? "üü¢ ABERTO AGORA" : "üî¥ FECHADO NO MOMENTO";
        });

        db.ref('cardapio').on('value', s => {
            const data = s.val() || {};
            const menu = document.getElementById('menu-render');
            menu.innerHTML = "";
            Object.keys(data).forEach(cat => {
                menu.innerHTML += `<h3 class="cat-title">${cat}</h3>`;
                Object.entries(data[cat]).forEach(([id, p]) => {
                    menu.innerHTML += `
                    <div class="product-card" style="${p.esgotado ? 'opacity:0.5; filter:grayscale(1);' : ''}">
                        <img src="${p.foto || 'https://via.placeholder.com/80'}" class="product-img">
                        <div style="flex:1">
                            <h4 style="font-size:0.9rem;">${p.nome}</h4>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
                                <b style="color:var(--marrom-claro)">R$ ${p.promo || p.preco}</b>
                                ${p.esgotado ? '' : `<button class="btn-add" onclick="addCarrinho('${p.nome}','${p.promo || p.preco}')">Adicionar</button>`}
                            </div>
                        </div>
                    </div>`;
                });
            });
        });

        function addCarrinho(n, p) {
            if(!lojaAberta) return alert("Estamos fechados!");
            const preco = parseFloat(p.replace(',','.'));
            const item = carrinho.find(i => i.n === n);
            if(item) item.qtd++; else carrinho.push({n, preco, qtd:1});
            atualizarBarra();
        }

        function mudarQtd(nome, delta) {
            const item = carrinho.find(i => i.n === nome);
            if(item) {
                item.qtd += delta;
                if(item.qtd <= 0) {
                    carrinho = carrinho.filter(i => i.n !== nome);
                }
            }
            if(carrinho.length === 0) fecharCheckout();
            atualizarBarra();
            renderizarResumo();
            atualizarTotal();
        }

        function atualizarBarra() {
            const bar = document.getElementById('cart-bar');
            const total = carrinho.reduce((acc, i) => acc + (i.preco * i.qtd), 0);
            bar.style.display = carrinho.length > 0 ? 'flex' : 'none';
            document.getElementById('cart-total-bar').innerText = `R$ ${total.toFixed(2).replace('.',',')}`;
        }

        function renderizarResumo() {
            const resumo = document.getElementById('resumo-itens');
            resumo.innerHTML = carrinho.map(i => `
                <div class="item-checkout">
                    <div style="flex:1">
                        <div style="font-weight:600; font-size:0.85rem">${i.n}</div>
                        <div style="font-size:0.75rem; color:#888">R$ ${(i.preco*i.qtd).toFixed(2).replace('.',',')}</div>
                    </div>
                    <div class="qtd-controls">
                        <button class="btn-qty" onclick="mudarQtd('${i.n}', -1)">-</button>
                        <span style="font-weight:bold; font-size:0.9rem; min-width:15px; text-align:center">${i.qtd}</span>
                        <button class="btn-qty" onclick="mudarQtd('${i.n}', 1)">+</button>
                    </div>
                </div>
            `).join('');
        }

        function abrirCheckout() {
            renderizarResumo();
            atualizarTotal();
            document.getElementById('modal-checkout').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function atualizarTotal() {
            const subtotal = carrinho.reduce((acc, i) => acc + (i.preco * i.qtd), 0);
            const taxaEntrega = parseFloat(document.getElementById('c-bairro').value);
            const pag = document.getElementById('c-pag').value;
            const precisaTroco = document.getElementById('c-precisa-troco').value;
            let taxaTroco = (pag === "Dinheiro" && precisaTroco === "Sim") ? 2 : 0;

            document.getElementById('box-taxa-troco').style.display = taxaTroco > 0 ? 'flex' : 'none';
            const total = subtotal + taxaEntrega + taxaTroco;

            document.getElementById('subtotal-val').innerText = `R$ ${subtotal.toFixed(2).replace('.',',')}`;
            document.getElementById('taxa-val').innerText = `R$ ${taxaEntrega.toFixed(2).replace('.',',')}`;
            document.getElementById('total-final').innerText = `TOTAL: R$ ${total.toFixed(2).replace('.',',')}`;
        }

        function fecharCheckout() { 
            document.getElementById('modal-checkout').style.display = 'none'; 
            document.body.style.overflow = 'auto';
        }

        function checkPagamento() { 
            const pag = document.getElementById('c-pag').value;
            document.getElementById('pix-box').style.display = (pag === 'Pix') ? 'block' : 'none'; 
            document.getElementById('box-troco').style.display = (pag === 'Dinheiro') ? 'block' : 'none'; 
            atualizarTotal();
        }

        function enviarWhatsApp() {
            const nome = document.getElementById('c-nome').value;
            const bairroSel = document.getElementById('c-bairro');
            const rua = document.getElementById('c-rua').value;
            if(!nome || bairroSel.value === "0" || !rua) return alert("Nome, Bairro e Rua s√£o obrigat√≥rios!");

            const total = document.getElementById('total-final').innerText;
            const itens = carrinho.map(i => `${i.qtd}x ${i.n}`).join('%0A');
            const pag = document.getElementById('c-pag').value;
            
            let msg = `*NOVO PEDIDO - RUSSO GOURMET*%0A%0A*Cliente:* ${nome}%0A*Bairro:* ${bairroSel.options[bairroSel.selectedIndex].text}%0A*End:* ${rua}%0A*Ref:* ${document.getElementById('c-ref').value}%0A*Pagamento:* ${pag}%0A`;
            if(pag === "Dinheiro" && document.getElementById('c-precisa-troco').value === "Sim") msg += `*Troco para:* ${document.getElementById('c-quanto-troco').value}%0A`;
            msg += `%0A*ITENS:*%0A${itens}%0A%0A*${total}*`;

            window.open(`https://wa.me/5513982155569?text=${msg}`);
        }
    </script>
</body>
</html>
